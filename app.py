import streamlit as st
import plotly.express as px
import pandas as pd

st.title('壢商升學小助手')

# Sidebar 選單
choice = st.sidebar.selectbox(
    "選擇操作", ['108~112登分各招生群(類)別錄取人數長條圖', '各招生群類別在不同年度的報名名額比較']
)

# 創建示例 DataFrame
data = {
    '錄取人數': ['09商業與管理群', '17餐旅群', '04電機與電子群資電類', '07設計群',
                '01機械群', '15外語群英語類', '03電機與電子群電機類', '13家政群生活應用類',
                '02動力機械群', '10衛生與護理類', '14農業群', '12家政群幼保類',
                '06土木與建築群', '16外語群日語類', '20藝術群影視類', '11食品群',
                '05化工群', '08工程與管理類', '19水產群', '18海事群', '招生群(類)別'],
    '錄取人數總和': ['01機械群', '02動力機械群', '03電機與電子群電機類', '04電機與電子群資電類',
                '05化工群', '06土木與建築群', '07設計群', '08工程與管理類',
                '09商業與管理群', '10衛生與護理類', '11食品群', '12家政群幼保類',
                '13家政群生活應用類', '14農業群', '15外語群英語類',
                '16外語群日語類', '17餐旅群', '18海事群', '19水產群', '20藝術群影視類', '招生群(類)別']
}

# 錄取人數次數
counts = [2499, 1774, 1287, 1093, 975, 870, 812, 648, 561, 422, 346, 292, 290, 274, 265, 242, 196, 87, 37, 25, 4]
counts1 = [10382, 3944, 7333, 11488, 2283, 2750, 10455, 348, 25157, 3907, 1615, 2123, 3911, 2379, 5855, 1610, 14744, 84, 222, 1042, 0]

# 根據選擇的操作繪製圖表
if choice == '108~112登分各招生群(類)別錄取人數長條圖':
    new_df2 = pd.DataFrame({'錄取人數': data['錄取人數'], '次數': counts})
    fig = px.bar(new_df2, x='錄取人數', y='次數', title='108~112錄取人數長條圖')
    st.plotly_chart(fig)    
    new_df2 = pd.DataFrame({'錄取人數總和': counts1, '招生群(類)別': data['錄取人數總和']})
    fig = px.bar(new_df2, x='招生群(類)別', y='錄取人數總和', title='各招生群(類)別錄取人數總和')
    st.plotly_chart(fig)
elif choice == '各招生群類別在不同年度的報名名額比較':
    # 示例數據框
    招生群類別 = [
        '01機械群', '02動力機械群', '03電機與電子群電機類', '04電機與電子群資電類',
        '05化工群', '06土木與建築群', '07設計群', '08工程與管理類',
        '09商業與管理群', '10衛生與護理類', '11食品群', '12家政群幼保類',
        '13家政群生活應用類', '14農業群', '15外語群英語類',
        '16外語群日語類', '17餐旅群', '18海事群', '19水產群', '20藝術群影視類','21資管類',
        '合計'  # 加入合計
    ]
    
    # 創建一個包含五個年度的 DataFrame
    years = ['108', '109', '110', '111', '112']
    
    # 確保每個招生群類別都有對應的招生名額
    counts_per_year = [
        [3047, 1302, 2191, 4257, 731, 1115, 4982, 89, 9041, 1264, 645, 1063, 1924, 902, 2202, 993, 7460, 52, 86, 659, 518, 44523 ],  # 108
        [3007, 1364, 2270, 4199, 716, 980, 4712, 80, 8385, 1228, 640, 1095, 1648, 818, 2091, 928, 7028, 44, 80, 587,531, 42431 ],  # 109
        [3229, 1298, 2341, 3785, 662, 1023, 4736, 56, 7936, 1240, 639, 1013, 1625, 720, 1833, 874, 6378, 56, 77, 522, 572,40255],  # 110
        [3276, 1406, 2393, 3965, 776, 1043, 4741, 40, 8676, 1378, 687, 1058, 1657, 783, 2142, 799, 6054, 49, 85, 524,555, 42087],  # 111
        [3154, 1328, 2470, 3736, 737,960, 4523, 36, 8703, 1295, 583,995, 1557, 794, 1933, 730, 5650, 50, 78, 492,566,40370]   # 112
    ]

    # 構建 DataFrame
    df_list = []  # 用於存儲每個年度的 DataFrame

    for i, year in enumerate(years):
        # 確保招生名額的長度與招生群類別的長度一致
        if len(counts_per_year[i]) != len(招生群類別):
            raise ValueError("招生名額的長度必須與招生群類別的長度一致。")

        temp_df = pd.DataFrame({
            '招生群類別': 招生群類別,
            '招生名額': counts_per_year[i],
            '年度': year
        })
        df_list.append(temp_df)

    # 合併所有年度的 DataFrame
    df = pd.concat(df_list, ignore_index=True)

    # 創建直方圖
    fig = px.histogram(
        df,
        x='招生群類別',
        y='招生名額',
        color='年度',
        barmode='group',         # 使用分組的方式顯示不同年度的數據
        labels={'招生名額': '報名名額', '招生群類別': '招生群類別'},  # 自定義標籤
        title='各招生群類別在不同年度的報名名額比較'
    )

    # 調整圖表佈局
    fig.update_layout(
        width=1000,               # 增加圖表寬度
        height=600,               # 增加圖表高度
        xaxis_tickangle=-45,      # 旋轉 X 軸標籤
        bargap=0.2                # 控制不同年度之間的間隔
    )

    # 在 Streamlit 中顯示圖表
    st.plotly_chart(fig)